# üîä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å–æ –∑–≤—É–∫–æ–º –≤ –∑–≤–æ–Ω–∫–∞—Ö

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Build 2026-02-24e

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `peerConnection.ontrack`:**
```javascript
peerConnection.ontrack = (event) => {
    if (!event.streams || !event.streams[0]) {
        console.warn('–ù–µ—Ç –ø–æ—Ç–æ–∫–æ–≤ –≤ —Å–æ–±—ã—Ç–∏–∏ ontrack');
        return;
    }
    remoteAudioEl.srcObject = event.streams[0];
    remoteAudioEl.play().then(() => {
        console.log('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å');
    });
};
```

2. **–î–æ–±–∞–≤–ª–µ–Ω—ã –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è Safari:**
```javascript
remoteAudioEl.setAttribute('x-webkit-airplay', 'allow');
```

3. **–£–ª—É—á—à–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç–∞:**
```javascript
remoteAudioEl.srcObject = null;
remoteAudioEl.pause();
remoteAudioEl.remove();
```

4. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –°–æ–∑–¥–∞–Ω–∏–µ audio —ç–ª–µ–º–µ–Ω—Ç–∞
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞
   - –ù–∞—á–∞–ª–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
   - –°–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## üß™ –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12) –≤ **–æ–±–µ–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

#### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–≤–æ–Ω–∫–µ:

**–í–∫–ª–∞–¥–∫–∞ 1 (–ó–≤–æ–Ω—è—â–∏–π):**
```
Audio call module loaded
Build 2026-02-24e (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∞—É–¥–∏–æ)
–°–æ–∑–¥–∞–Ω remote audio —ç–ª–µ–º–µ–Ω—Ç
–ü–æ–ª—É—á–µ–Ω —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ç—Ä–µ–∫ (outgoing): MediaStreamTrack {...}
–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ –Ω–∞—á–∞–ª–æ—Å—å (outgoing)
–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: connected
–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
```

**–í–∫–ª–∞–¥–∫–∞ 2 (–ü—Ä–∏–Ω–∏–º–∞—é—â–∏–π):**
```
Audio call module loaded
–°–ª—É—à–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏ –¥–ª—è: user2
–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –æ—Ç: user1 callId: -abc123...
–°–æ–∑–¥–∞–Ω remote audio —ç–ª–µ–º–µ–Ω—Ç
–ü–æ–ª—É—á–µ–Ω —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ç—Ä–µ–∫: MediaStreamTrack {...}
–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ –Ω–∞—á–∞–ª–æ—Å—å
–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: connected
–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç–∞

–í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è audio —ç–ª–µ–º–µ–Ω—Ç–∞
const audio = document.querySelector('audio');
console.log('Audio —ç–ª–µ–º–µ–Ω—Ç:', audio);
console.log('srcObject:', audio?.srcObject);
console.log('volume:', audio?.volume);
console.log('muted:', audio?.muted);
console.log('paused:', audio?.paused);
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `audio` - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `srcObject` - MediaStream –æ–±—ä–µ–∫—Ç
- `volume` - 1
- `muted` - false
- `paused` - false

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ WebRTC —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

–í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ PeerConnection
if (peerConnection) {
    peerConnection.getStats().then(stats => {
        stats.forEach(report => {
            if (report.type === 'inbound-rtp' && report.kind === 'audio') {
                console.log('–ü–æ–ª—É—á–µ–Ω–æ –±–∞–π—Ç –∞—É–¥–∏–æ:', report.bytesReceived);
                console.log('–ü–æ—Ç–µ—Ä—è–Ω–æ –ø–∞–∫–µ—Ç–æ–≤:', report.packetsLost);
            }
        });
    });
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `bytesReceived` > 0 (–∏–¥–µ—Ç –ø—Ä–∏–µ–º –∞—É–¥–∏–æ)
- `packetsLost` - –Ω–µ–±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ –∏–ª–∏ 0

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

–í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
if (localStream) {
    const tracks = localStream.getTracks();
    console.log('–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–∫–∏:', tracks);
    tracks.forEach(track => {
        console.log('  –¢–∏–ø:', track.kind);
        console.log('  –í–∫–ª—é—á–µ–Ω:', track.enabled);
        console.log('  –ú—É—Ç:', track.muted);
    });
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å—Ç—å audio track
- `enabled: true`
- `muted: false`

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "–ù–µ—Ç –ø–æ—Ç–æ–∫–æ–≤ –≤ —Å–æ–±—ã—Ç–∏–∏ ontrack"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `localStream` –Ω–µ –ø—É—Å—Ç
3. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: NotAllowedError"

**–ü—Ä–∏—á–∏–Ω–∞:** –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ö–ª–∏–∫–Ω–∏—Ç–µ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ä–∞–∑—Ä–µ—à–∏—Ç—å –∞—É–¥–∏–æ)
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. –†–∞–∑—Ä–µ—à–∏—Ç–µ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –≤ `ensureRemoteAudioEl()`

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é
const audio = document.createElement('audio');
audio.autoplay = true;
document.body.appendChild(audio);
console.log('–°–æ–∑–¥–∞–Ω:', audio);
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –µ—Å—Ç—å, –Ω–æ –∑–≤—É–∫–∞ –Ω–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–µ–∫–æ–º –∏–ª–∏ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∏–Ω–∞–º–∏–∫–∏ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω—ã
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–î–∏–Ω–∞–º–∏–∫" –≤ –∑–≤–æ–Ω–∫–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 5: "WebRTC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"

**–ü—Ä–∏—á–∏–Ω–∞:** –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –±—Ä–∞—É–∑–µ—Ä

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome 90+, Firefox 88+, Edge 90+
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ HTTPS (–∏–ª–∏ localhost)

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∑–≤–æ–Ω–∫–∞

### –ß–µ–∫-–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞:

- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –µ—Å—Ç—å "Audio call module loaded"
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –µ—Å—Ç—å "–°–æ–∑–¥–∞–Ω remote audio —ç–ª–µ–º–µ–Ω—Ç"
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –µ—Å—Ç—å "–ü–æ–ª—É—á–µ–Ω —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ç—Ä–µ–∫"
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –µ—Å—Ç—å "–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å"
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –µ—Å—Ç—å "–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: connected"
- [ ] –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ DOM
- [ ] `srcObject` –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ null
- [ ] –ì—Ä–æ–º–∫–æ—Å—Ç—å = 1, muted = false
- [ ] –ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω (–Ω–µ –Ω–∞ –º—É—Ç–µ)

## üéØ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:
```javascript
(function() {
    console.log('=== –ü–†–û–í–ï–†–ö–ê –ó–í–û–ù–ö–ê ===');
    console.log('1. Audio —ç–ª–µ–º–µ–Ω—Ç:', document.querySelector('audio') ? '‚úì' : '‚úó');
    console.log('2. peerConnection:', typeof peerConnection !== 'undefined' ? '‚úì' : '‚úó');
    console.log('3. localStream:', typeof localStream !== 'undefined' && localStream ? '‚úì' : '‚úó');
    console.log('4. remoteAudioEl:', typeof remoteAudioEl !== 'undefined' && remoteAudioEl ? '‚úì' : '‚úó');
    
    if (remoteAudioEl) {
        console.log('   - srcObject:', remoteAudioEl.srcObject ? '‚úì' : '‚úó');
        console.log('   - volume:', remoteAudioEl.volume);
        console.log('   - muted:', remoteAudioEl.muted);
        console.log('   - paused:', remoteAudioEl.paused);
    }
    
    if (peerConnection) {
        console.log('5. –°–æ—Å—Ç–æ—è–Ω–∏–µ:', peerConnection.connectionState);
        console.log('6. ICE —Å–æ—Å—Ç–æ—è–Ω–∏–µ:', peerConnection.iceConnectionState);
    }
    
    console.log('=== –ö–û–ù–ï–¶ –ü–†–û–í–ï–†–ö–ò ===');
})();
```

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [WebRTC API](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API)
- [RTCPeerConnection](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection)
- [getUserMedia API](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)

---

**–í–µ—Ä—Å–∏—è:** 2026-02-24e
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê—É–¥–∏–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
